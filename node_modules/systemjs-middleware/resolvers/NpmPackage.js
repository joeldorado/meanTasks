"use strict";
var path = require("path");
var configurator = require("../core/config");
var fs_1 = require("../helpers/fs");
var helpers_1 = require("./helpers");
var config = configurator.get();
var ResolverNpmPackage = (function () {
    function ResolverNpmPackage() {
    }
    Object.defineProperty(ResolverNpmPackage.prototype, "name", {
        get: function () {
            return "NpmPackage";
        },
        enumerable: true,
        configurable: true
    });
    ResolverNpmPackage.prototype.resolve = function (packageName, logger) {
        var packageJson = path.join(config.basePath, "node_modules/" + packageName + "/package.json");
        return fs_1.fileExists(packageJson).then(function (exists) {
            if (!exists) {
                logger.log("SKIP NpmPackage lookup since package.json: " + packageJson + " was not found");
                return "";
            }
            return fs_1.readJson(packageJson).then(function (json) {
                if (!json.main) {
                    logger.log("SKIP NpmPackage lookup since package.json has main attribute");
                    return "";
                }
                var relPath = "node_modules/" + packageName + "/" + json.main;
                return helpers_1.resolveWithExtensions(relPath, ["", "js"], logger);
            });
        });
    };
    return ResolverNpmPackage;
}());
exports.ResolverNpmPackage = ResolverNpmPackage;
